---
title: "Bellabeat Smart Device"
author: "Ivan Fung"
date: "2022-10-30"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

## Company 

Bellabeat is a small successful high-tech manufacturer of health-focused products for women, and it offers different smart devices that collect data on activity, sleep, stress, and reproductive health to empower women with knowledge about their own health and habits.  Management of Bellabeat see the potential growth of the company to become a major player in the global smart device market. In 2016 Bellabeat has launched multiple products and expanded their business globally. Initially the products became available on their own e-commerce channel and online retailers. Bellabeat has been focused on digital marketing extensively, including Google Search, video ads, and consumer engagement on social media platforms.

## The Business Task 

As a data analyst working on the marketing analyst team, I was asked to analyze the available open smart device data to gain insight into consumers usage of their smart devices.  As part of my tasks, I have to apply my insights on one of the Bellabeat's exsiting products for the future marketing campaign.  

*Existing Products*

Bellabeat app: provides users with health data related data to their activity, sleep, stress, menstrual cycle, etc.

Leaf: classic wellness tracker can be worn as a bracelet, necklace, or clip.

Time: wellness watch combines the timeless look of a classic timepiece with smart technology

Spring: a water bottle that tracks daily water intake using smart technology


  * The focus will be on Bellabeat App for recommendations.  

*Key Stakeholders*

  * Urška Sršen: cofounder and Chief Creative Officer.
  * Sando Mur: cofounder and a key member of the Bellabeat executive team.
  * Bellabeat marketing analytics team
  
## Prepare  

There are 18 CSV files available from FitBit Fitness Tracker Data (CC0: Public Domain, dataset made available through Mobius). 
The datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk, the dataset has been verified to be open-source.  As a result, it can be copied, modified, and distributed without permission.

Datasets includes 33 Fitbit user activity and data over a month period (31 days) that will help answer the business tasks.

R and RStudio were adopted to prepare, process, analyze and visualize the datasets. The files will be downloaded to local PC and was carrying out within the Rstudio.  

*Data limitations*

  * The data provided is outdated (2016).
  * Small sample size (8-33 users within various data sets).
  * Demographic information, such as gender and age is unavailable.
  * Sampling bias may be present

*Loading the packages*
```{r}

library(ggplot2)       # Visualization
library(ggthemes)      # Visualization
library(scales)        # Visualization
library(dplyr)         # Data Manipulation
library(mice)          # Imputation
library(tidyverse)
library(skimr)
library(janitor)
library(lubridate)
library(tidyr)

```

Among the 18 csv files which has been provided from the datasets, I only selected few relevant data files for the analysis.  These files included:

  * dailyActivity_merged
  * sleepDay_merged
  * hourlySteps_merged

From the preliminary review of these files, most of the files are incomplete with limited participants' data recorded.  As a result, I chose files which have the most recorded data of most of the participants (33 participants) which were collected by the providers during that time.

*Importing the datasets*

```{r}
Daily_Activity.data <- read.csv("C:/Users/ikinf/OneDrive/Desktop/Ivan/Google Analytics/Case studies/Datasets/dailyActivity_merged.csv")

Sleep_Data<- read.csv("C:/Users/ikinf/OneDrive/Desktop/Ivan/Google Analytics/Case studies/Datasets/sleepDay_merged.csv")

hourly_steps <- read.csv("C:/Users/ikinf/OneDrive/Desktop/Ivan/Google Analytics/Case studies/Datasets/hourlySteps_merged.csv")

```

*Preview of the imported datasets*

By using the function View() and glimpse() to get an overview of the datasets and the summary of each column

```{r}
View(Daily_Activity.data)
glimpse(Daily_Activity.data)

View(Sleep_Data)
glimpse(Sleep_Data)


View(hourly_steps)
glimpse(hourly_steps)
```
# Process

*Cleaning and formatting*
After reviewing the data strucutures, we would process the data cleaning and any necessary formatting before proceeding to the Analyze phase of the case study.

*Identify Duplicates data in dataset*

```{r}
sum(duplicated(Daily_Activity.data))
sum(duplicated(Sleep_Data))
sum(duplicated(hourly_steps))

```

*There are 3 duplicates in Sleep Data dataframe; we will drop the duplicates before proceeding*
#Use unique function to return only the uniques values for the dataframe

```{r}

Sleep_Data <- unique(Sleep_Data)
```

#To verify if there is any more duplicates remain in the dataframe; we will use the sum(duplicated()) functions 

```{r}
sum(duplicated(Sleep_Data))
```
*Converting Date format from character to date format in dataframes: column "SleepDate","ActivityDate" & "ActivityHour"*

After reviewing the data "Date" columns in each dataset, I noticed that they are all in character type.  As a result, I reformatted these columns into Date or Date_time format for our further analysis.  
I used as.Date() and as.POSIXct() for formatting the columns into Date or Date time format.

```{r}
Daily_Activity.data$ActivityDate <- as.Date(Daily_Activity.data$ActivityDate, format= "%m/%d/%Y")

View(Daily_Activity.data)

str(Daily_Activity.data)


Sleep_Data$SleepDay <- as.Date(Sleep_Data$SleepDay, format= "%m/%d/%Y")

View(Sleep_Data)

str(Sleep_Data)

hourly_steps$date_time <-as.POSIXct(hourly_steps$ActivityHour, format = "%m/%d/%Y %H:%M")

View(hourly_steps)

hourly_steps <- hourly_steps %>%
  separate(date_time, into = c("date", "time"), sep= " ") %>%
  mutate(date = ymd(date)) 

head(hourly_steps)



```
*Rename column names in datafrane Daily_Activiy.data and Sleep_Data*


```{r}

Daily <- rename(Daily_Activity.data, Date = ActivityDate)

Sleep <- rename(Sleep_Data, Date = SleepDay)

head(Daily)
head(Sleep)

```

# Analyze Phase and Share Phase

In my first part of the analysis, I used the hourly_step dataset to gain insight about the peak hours which the users will have the most activities (number of steps) of each day.  As a result, I can see the different level of hourly steps throughout the day by appling groupby() and summarize() functions to capture the average steps in total from each hour.  


```{r}
steps_by_hour <- hourly_steps%>%
  group_by(time) %>%
  summarize(average_steps = mean(StepTotal))

View(steps_by_hour)


ggplot() +
  geom_col(mapping = aes(x=steps_by_hour$time, y = steps_by_hour$average_steps, fill = steps_by_hour$average_steps)) + 
  labs(title = "Hourly steps throughout the day", x="", y="") + 
  scale_fill_gradient(low = "white", high = "blue")+
  theme(axis.text.x = element_text(angle = 90))


```



As illustrated in the visualization of bar charts, users were more active during the day time from 8 am to 8 p.m., and the peak hours with most average steps taken by the user are between lunch hours (12 am to 2 pm) and evening from 5 pm to 7 pm.  

*Correlation among different variables*

After analysis the hourly steps taken by the users, I will proceed with the analysis of the correlation amount different variables.  I selected three variables which I believed would have direct relationship with the Calories burned recored by the smart device.  Since I want to look at the correlations among the number of TotalSteps, TotalDistance, Calories burned, and amount of Sedentary minutes, I have to merged two dataframes: Daily_Activity.data and Sleep_Data for analysis.  I used the merge function() to combine the tables together, and use the "id" and "Date" as the keys for matching the tables together. 

```{r}

data_df <- merge(Daily, Sleep, By=c("id", "Date"), all.x = TRUE)

View(data_df)


glimpse (data_df)

str(data_df)
```

**Correlation between variables: TotalSteps & Calories**


```{r}
ggplot(data=data_df) + geom_smooth(mapping = aes(x=TotalSteps, y=Calories), method ="lm") +
  geom_point(mapping = aes(x=TotalSteps, y=Calories))
```




Scatter plot between Calories and Total Steps shown there was a positive correlation between these two variables.  It makes sense that users can have more calories burned with more steps taken by the users.

**Correlation between variables: TotalDistance & Calories**

```{r}

ggplot(data=data_df) + geom_smooth(mapping = aes(x=TotalDistance, y=Calories), method ="lm") +
  geom_point(mapping = aes(x=TotalDistance, y=Calories))
```





Similarly, scatter plot between Calories and TotalDistance shown there was a positive correlation between these two variables.  More calories will be burned with more walking distance being taken by the users.

**Correlation between variables: SedentaryMinutes & Calories**


```{r}

ggplot(data=data_df) + geom_smooth(mapping = aes(x=SedentaryMinutes, y=Calories), method ="lm") +
  geom_point(mapping = aes(x=SedentaryMinutes, y=Calories))

```




Scatter plot between Calories and Sedentary Minutes shown there was a slight negative correlation between these two variables.  It reveals that the more sedentary minutes the users took, the less calories burned would be recorded by the smart device.

**Use of smart device** 

After finding some relationships about the calories burned with other variables.  I decided to look into data relating to Days used smart device by the users to have better understanding of the usage of smart device in users' daily activities.  It is important to know how often do the users in the sample population use their device, so that we can plan our marketing strategy and see what features would benefit the use of smart devices.


I classified the sample data into three categories in accordance with the amount of time they used the smart device during the observation period.

  * high usage - wearing the device 80% of the whole monitoring period
  * moderate usage - wearing the device 40-80% of the whole monitoring period
  * low usage     - wearing the devices less 40% of the whole monitoring period

I created a new dataframe which will group by all users by id to determine the percentage of day time which the users have readings from the device within the monitoring period. A new column will be created so that we classify whether user was a high-usage, moderate-usage, low-usage participant

```{r}
usage_data <- data_df %>% 
  filter(TotalSteps !=0) %>% 
  group_by(Id) %>% 
  summarize(usage_days =(sum(n()))) 

usage_data <- usage_data %>% 
  mutate(percentage_usage = ((usage_days/31)*100))

usage_data$percentage_usage <- round(usage_data$percentage_usage, digits =2)

View(usage_data)

str(usage_data)

usage_data$Usage_Level[usage_data$percentage_usage <=40] <- "Low"

usage_data$Usage_Level[usage_data$percentage_usage >40 & usage_data$percentage_usage<=80] <- "Moderate"

usage_data$Usage_Level[usage_data$percentage_usage >80 & usage_data$percentage_usage<=100 ] <- "High"


View(usage_data)

```
Using the ggplot, the usage level was plotted in bar chart to demonstrate the frequency of each usage level

```{r}

ggplot(data = usage_data, aes(x = usage_days)) +
  geom_bar(stat = "count", position = "dodge", fill = "Blue")


mean_time_usage <- usage_data %>% 
  summarise(mean(usage_days))

mean_time_usage

```



According to the bar charts, the majority of the users wore the device for at least 80% of the time.  The average time wore by the whole sample population was 26.15 days.

Based on the Sleep_Data file, the average sleeping time for each user in the sample population was determined.  Using the group_by() and summarise() functions to get insight about the average number of hours of each of the 24 participants.  However, there were some missing number in the dataset, and there are only participants whom had the sleeping records.  I would still continue the analysis to get an idea about the sleeping time for these 24 participants even there were less than the minimal sample size of 30.

```{r}
 average_sleep <- Sleep_Data %>%
  group_by(Id) %>%
  summarise (mean_sleep_time = mean(TotalMinutesAsleep))


summary(average_sleep)
#mean_avg_sleep <- average_sleep %>% 
#  summarise(mean(mean_sleep_time))

#mean_avg_sleep
```



The average sleeping time from the 24 participants over the observation period was about 377.4 minutes (about 6.3 hours).  The maximum number of sleeping time was 652 minutes while the minimum sleep time recorded was 61 minutes.


```{r}
Sleep_Data <- Sleep_Data %>% 
  mutate(sleep_quality = ifelse(TotalMinutesAsleep <= 360, 'Less than 6 hr sleep',
                         ifelse(TotalMinutesAsleep <= 480, '6 hr to 8 hr sleep', 
                         'More than 8 hr sleep'))) %>%
  mutate(sleep_quality = factor(sleep_quality, 
                          levels = c('Less than 6 hr sleep','6 hr to 8 hr sleep',
                                     'More than 8 hr sleep')))

View(Sleep_Data)

ggplot(Sleep_Data, aes(x = TotalMinutesAsleep, fill = sleep_quality)) +
  geom_histogram(position = 'dodge', bins = 30) +
  scale_fill_manual(values=c("grey", "#80c7d5", "lightcoral")) +
  theme(legend.position = c(.80, .80),
        legend.title = element_blank(),
        legend.spacing.y = unit(0, "mm"), 
        panel.border = element_rect(colour = "black", fill=NA),
        legend.background = element_blank(),
        legend.box.background = element_rect(colour = "black")) +
  labs(
    title = "Sleep distribution for only 24 participants",
    x = "Time slept (minutes)",
    y = "Count")
```




After look at the sleep time of the users, I studied the daily activity dataframe and to determine the average daily activity, average Calories burned, and the average sedentary time for each user.  
We can determine the type of users in accordance with the average daily steps she took each day.  The classification has been made from the article !https://www.10000steps.org.au/articles/counting-steps/ and the CDC Daily Steps Recommendation !https://www.cdc.gov/media/releases/2020/p0324-daily-step-count.html

  * Sedentary - Less than 5000 steps a day.

  * Lightly active - Between 5000 and 7499 steps a day.

  * Fairly active - Between 7500 and 9999 steps a day.

  * Very active - More than 10000 steps a day.



```{r}


daily_average <- data_df %>%
  group_by(Id) %>%
  summarise (mean_daily_steps = mean(TotalSteps), mean_daily_calories = mean(Calories), mean_sedentarytime = mean(SedentaryMinutes))

View(daily_average)

daily_average <- daily_average %>% 
  mutate(steps_category = case_when(
         mean_daily_steps < 5000 ~ "Sedentary",
         mean_daily_steps >= 5000 & mean_daily_steps<= 7499 ~ "Lightly Active",
         mean_daily_steps >=7500 & mean_daily_steps<= 9999 ~ "Farily Active",
         mean_daily_steps >=10000 ~ "Very Active"))
View(daily_average)

```

*To get insight of the particular usage-level of the smart device user would lead to more exercise and sedentary time, I merged 2 subsets of the dataframes: usage_data and daily_average*

```{r}

usage_mean_activity <- merge(daily_average, average_sleep, By="Id", all = TRUE)

View(usage_mean_activity)

usage_level_mean <- merge(usage_data, usage_mean_activity, By="Id", all = TRUE)

View(usage_level_mean)

```
To illustrate the results, I constructed the pie chart for the visualization.  

```{r}

library(webr)

PieDonut(usage_level_mean, aes(Usage_Level, steps_category),
         explode = 1,
         explodeDonut = TRUE,
         title = "Usage Level vs average daily steps")


```




We can see that about 64% of the participating users were high usage of smart device and among these participants (21 users) there were about 28.6% very-active in taking the exercise with more than 10,000 steps in each day.  About 38% of the high usage participants were fairly active in her daily activities with steps from 7500 to 10000 steps.  

From the results of pie chart, the high-usage group of smart device with relatively low percentage of daily time at sedentary.  We can infer from this result that longer time in wearing the smart device would lead to the user to become more active in moving the body and less time at sedentary.

Besides, the donut pie chart.  I used the Facet_Grid() function to showcase the different usage level of the participant against different level of activity with in one visualization.  


```{r}
 
ggplot(usage_level_mean, aes(x= reorder(Usage_Level, -mean_daily_steps), y= mean_daily_steps))+
  geom_bar(stat="identity", fill = "Blue", width =0.5)+ 
  facet_grid(.~steps_category)+
  theme_minimal()+
  labs(
    title = "Active Level vs Usage-Level",
    x = "Usage-Level",
    y = "Average daily Steps")
```




# Conclusion & Recommendation

From the results of the analysis, I believe that smart device could provide incentive for user to become more active in her daily activities.  The results also shown that the more time wearing the device, the less time for the sedentary.  BellaBeat app could be a good solution for those people whom aren't exercise enough and want to have more calories burned.  The app could periodically send alerts to users to encourage activity and remind them to achieve the daily goal of 10,000 steps.  Furthermore, the app could provide vital health and diet alters to user to continuously monitoring the health and diet condition of the user.  

In addition to the periodic notification about health and diet information, BellaBeat can promote users to practice a more regular 8 hours sleeping habit to maintain a better health. From the results,  the 24 participants with sleep records shown the average sleep time was less than 8 hours a day. BellaBeat could help user by setting up a desired time to go to sleep and receive a notification minutes before to prepare to sleep.  The company can offer additional resources to help users to fall asleep faster by providing breathing exercise, advises, relaxing music, sleep techniques when upgrading the BellaBeat app in the future App development.

The dataset provided, however, was not large enough (about 30 participants) to draw very reliable conclusions due to the bias and the lack of important details such as the demographic, sex, and age details of users.  
Since Bellabeat's target customer is young and adult women, it would be beneficial to collect usage data from this group of user and to investigate any particular trends which might help to better market the products for this group of user.











